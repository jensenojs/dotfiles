# OpenCode 全局指令

## 语言与对话

- **默认使用中文**进行对话和思考，除非用户明确要求使用其他语言
- 在给出决策或建议前说明依据，如需假设请显式声明
- 发现需求不清时，优先澄清后再执行

## 版本控制与提交规范 (Git)

- 在 git 仓库中工作时，默认在独立分支上开发（除非明确要求在主分支上直接修改）
- 保持工作树干净：提交前使用 `git status` / `git diff` 检查，避免将调试代码或临时文件提交进仓库
- 提交粒度尽量小而完整：一类改动对应一个提交，避免「大杂烩」式提交
- 提交信息可以借助 `/commit-message` 命令生成，但必须包含**为什么要改**，而不仅是「改了什么」
- 不主动推送代码到远端, 在推送前本地运行必要的测试；如有 GitHub CI，推送后关注结果并修复失败用例

## 开发与文档约定

| 领域 | 约定 | 要点 |
| --- | --- | --- |
| Python 开发 | 使用 `uv` 管理环境与依赖 | `uv run` 运行脚本，`uvx` 运行工具程序，避免全局 `pip install` |
| JavaScript/TypeScript 开发 | 使用 `deno` 运行脚本，使用 `npx` 调用 npm CLI | 优先无全局安装，脚本保持可复现、无隐性副作用 |
| 文档查阅 | 优先官方文档 + llms.txt + Context7 | 新库/工具先查官网/GitHub/llms.txt，必要时用 Context7 MCP 检索 |
| 代码规范 | 引用与配置变更说明 | 引用代码时注明 `路径:行号`，修改配置前简要说明意图与影响，统一使用半角标点 |


## 工具使用

### MCP 工具使用指南

在需要外部信息、文档、结构化代码分析, 复杂问题梳理(领域特定调研, 架构设计)或文档转换时，优先调用合适的 MCP 工具

**重要提示**：遇到架构设计、性能分析、问题诊断、复杂推理等场景时，**必须调用 sequential-thinking** 进行结构化思维分析

| 工具 | 用途 | 触发关键词 | 典型场景 |
|---------|------|------------|----------|
| **Tavily** | Web 搜索，技术文档检索 | "搜索最新"、"查找最新"、"安全补丁"、"新特性"、"CVE" | "搜索 Redis 最新安全补丁"、"查找 React 18 新特性" |
| **minimax-coding-plan** | 图片理解与视觉分析 | "图片分析"、"图像理解"、"图片内容" | "分析头像"、"理解截图内容" |
| **Context7** | 语义检索，开源项目文档 | "如何用"、"API 方式"、"鉴权方式"、"实现方式" | "如何用 Node.js 连接 MongoDB"、"GitHub API 鉴权方式" |
| **ast-grep** | AST 代码结构分析 | "查找所有"、"使用模式"、"调用链"、"结构分析" | "查找所有 React useEffect"、"分析某函数的调用链" |
| **sequential-thinking** | 结构化推理，问题分解 | "设计架构"、"分析瓶颈"、"推理"、"结构化分析" | "设计分布式缓存架构"、"分析性能瓶颈" |
| **serena** | 代码库理解，项目分析 | "理解架构"、"项目分析"、"依赖关系"、"深度分析" | "分析整个项目的架构"、"理解复杂业务逻辑" |
| **Jupyter** | 数据分析和可视化 | "数据可视化"、"性能数据"、"机器学习"、"数据分析" | "分析系统性能数据"、"机器学习模型训练" |
| **markitdown** | 文档格式转换 | "转换格式"、"PDF转Markdown"、"批量处理文档" | "将 PDF 转换为 Markdown"、"批量处理文档" |
| **GitHub** | 仓库管理，协作开发 | "我的PR"、"查看提交"、"issue"、"PR状态"、"安全问题" | "搜索 Vue.js 相关的安全问题 issue"、"查看某框架的 PR 状态" |
| **DeepWiki** | 获取 GitHub 仓库文档并转换为 Markdown | "获取文档"、"项目文档"、"API指南" | "获取某个项目的完整文档"、"获取 API 使用指南" |
| **gh_grep** | GitHub 代码搜索，代码示例查找 | "查找用法"、"实际用法"、"最佳实践"、"代码示例" | "查找 React useState 的实际用法"、"查看 React Router 的最佳实践" |
| **图片理解** | 图像内容分析和理解 | "图片分析"、"图像理解"、"图片内容" | "分析头像"、"理解截图内容" |

#### 工具选择原则

**代码分析优先顺序**：
1. **ast-grep**: 优先用于代码结构分析、模式匹配、调用链分析
2. **serena**: 用于代码库理解、依赖关系分析、架构理解
3. **传统工具**: rg, grep等是作为回退选择, 不优先使用

**复杂问题处理**：
- 遇到架构设计、性能分析、问题诊断等复杂场景时，**必须调用 sequential-thinking**
- 使用结构化思维进行问题分解和推理

#### 常用工具组合

**技术调研**:
```bash
# 调研微服务架构最佳实践
# 1. Tavily: 搜索最新微服务架构案例
# 2. Context7: 查找具体开源项目实现
# 3. sequential-thinking: 结构化分析优缺点
# 4. gh_grep: 查找实际代码实现示例
```

**代码分析**:
```bash
# 分析现有代码质量
# 1. ast-grep: 搜索代码模式和反模式
# 2. serena: 理解代码架构和依赖关系
# 3. Context7: 查找业界最佳实践对比
# 4. gh_grep: 查看相似项目的实现方式
```

**问题调研与追踪**:
```bash
# 调研技术问题背景和解决方案
# 1. GitHub: 搜索相关项目的 issue/PR 和讨论
# 2. Context7: 查阅技术文档
# 3. DeepWiki: 获取仓库完整文档
# 4. sequential-thinking: 分析问题的根本原因和解决方案路径
```

### 命令行工具

| 工具 | 用途 | 触发关键词 | 备注 |
| --- | --- | --- | --- |
| gh | 与 GitHub 交互 | "GitHub操作"、"issues管理"、"PR操作"、"CI状态" | 查看 / 管理 issues、PR、CI 结果 |
| jq | 解析与过滤 JSON | "JSON解析"、"过滤数据"、"提取字段" | 从复杂 JSON 中提取所需字段 |
| rg | 快速文本搜索 | "文本搜索"、"文件搜索"、"grep替代" | 优先于 `grep`，支持 glob 与忽略规则 |
| pbcopy / pbpaste | 系统剪贴板 | "复制粘贴"、"剪贴板"、"数据传输" | 在 shell 与系统剪贴板之间传输内容 |
| curl | HTTP 请求 | "网络请求"、"API调用"、"获取内容" | 获取网页内容或 API 响应 |
