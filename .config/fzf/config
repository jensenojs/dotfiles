# https://github.com/junegunn/fzf/blob/master/README.md
# =============================================================================
# FZF æ ¸å¿ƒé…ç½®æ–‡ä»¶ (FZF Ultimate Configuration)
# ç­–ç•¥: Tabç§»åŠ¨ | Ctrl-J/Kå¤šé€‰ | å¢å¼ºé¢„è§ˆ | Gruvboxé€æ˜ä¸»é¢˜
# =============================================================================

# 1. æ ¸å¿ƒè·¯å¾„å®šä¹‰
# -----------------------------------------------------------------------------
# ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™: chmod +x ~/.config/fzf/preview.sh
_FZF_PREVIEW_SCRIPT="$HOME/.config/fzf/preview.sh"

# 2. æœç´¢å¼•æ“è®¾ç½® (FD Integration)
# -----------------------------------------------------------------------------
# --type f: ä»…æ–‡ä»¶ | --hidden: æœéšè— | --follow: è¿½è½¯é“¾
export FZF_DEFAULT_COMMAND="fd --type f --hidden --follow --max-depth 5 \
  --exclude={.git,.idea,.vscode,.serena,.sass-cache,node_modules,build,dist,target,__pycache__,.pytest_cache,.mypy_cache,.venv,venv,.DS_Store} \
  2>/dev/null"

# [Ctrl-T] æ–‡ä»¶æœç´¢
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"

# [Alt-C] ç›®å½•è·³è½¬ (ä¼ é€é—¨)
# ç­–ç•¥: ç›®å½•è·³è½¬é€šå¸¸æ˜¯ä¸ºäº†å»â€œåˆ«çš„åœ°æ–¹â€ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬æŒ‡å®šä» $HOME å¼€å§‹æœï¼Œ
export FZF_ALT_C_COMMAND="fd --type d --hidden --follow --max-depth 5 \
  --exclude={.git,.idea,.vscode,node_modules,build,dist,target,venv} \
  . \"$HOME\""
# æ³¨æ„ä¸Šé¢çš„ . "$HOME" è¡¨ç¤ºåœ¨ Home ç›®å½•ä¸‹ä¸€å±‚å±‚æ‰¾

# 3. è§†è§‰ä¸è¡Œä¸ºæ ¸å¿ƒ (Appearance & Behavior)
# -----------------------------------------------------------------------------
# æ ¸å¿ƒè®¾ç½®:
# --multi: å¼€å¯å¤šé€‰
# --layout=reverse: æœç´¢æ åœ¨é¡¶éƒ¨
export FZF_DEFAULT_OPTS="
  --height 90%
  --layout=reverse
  --border=rounded
  --info=inline
  --multi
  --prompt='ğŸ”­ '
  --pointer='â–¶'
  --marker='âœ“'
  --scrollbar='â”‚'
  --color=bg:-1,bg+:#3c3836,fg:#bdae93,fg+:#ebdbb2
  --color=hl:#fabd2f,hl+:#fe8019,info:#fabd2f,header:#83a598
  --color=prompt:#fabd2f,pointer:#8ec07c,marker:#8ec07c,spinner:#8ec07c
  --color=border:#504945,separator:#665c54,preview-bg:-1,preview-fg:#bdae93
"

# 4. é”®ä½ç»‘å®š (Key Bindings)
# -----------------------------------------------------------------------------
export FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS

  # --- å¯¼èˆª (Navigation) ---
  # [éœ€æ±‚] Tab / Shift-Tab å›å½’ç§»åŠ¨åŠŸèƒ½
  --bind 'tab:down,shift-tab:up'
  # ä¿ç•™ Ctrl-N/P ä½œä¸ºç¬¬äºŒå¥—ç§»åŠ¨æ–¹æ¡ˆ
  --bind 'ctrl-n:down,ctrl-p:up'

  # --- å¤šé€‰ (Selection) ---
  # [éœ€æ±‚] Ctrl-J/K æ¥ç®¡å¤šé€‰åŠŸèƒ½ (Toggle + Move)
  --bind 'ctrl-j:toggle+down,ctrl-k:toggle+up'
  # ä¿ç•™ Space ä½œä¸ºå¤‡ç”¨å¤šé€‰
  --bind 'space:toggle+down'
  # å…¨é€‰/åé€‰
  --bind 'ctrl-a:select-all,ctrl-x:deselect-all'

  # --- é¢„è§ˆæ§åˆ¶ (Preview) ---
  # Ctrl-/ å¼€å…³é¢„è§ˆ
  --bind 'ctrl-/:toggle-preview,?:toggle-preview'
  # æ»šåŠ¨é¢„è§ˆçª—å£ (ä¸ç§»åŠ¨å…‰æ ‡)
  --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up'
  --bind 'alt-w:toggle-preview-wrap'

  # --- è¾…åŠ©æ“ä½œ ---
  # å¿«é€Ÿè·³è½¬
  --bind 'alt-up:first,alt-down:last'
  # å‰ªè´´æ¿å¤åˆ¶
  --bind 'ctrl-y:execute-silent(echo -n {+} | (pbcopy || xclip -selection clipboard) 2>/dev/null)+abort'
  --bind 'esc:clear-query'
"

# 5. æ¨¡å¼ç‰¹å®šé…ç½® (Mode Specific)
# -----------------------------------------------------------------------------

# [Ctrl-T] æ–‡ä»¶æœç´¢
# Header æç¤ºå·²æ›´æ–°: Tabç§»åŠ¨, Ctrl-J/Kå¤šé€‰
export FZF_CTRL_T_OPTS="
  --preview '$_FZF_PREVIEW_SCRIPT {}'
  --preview-window 'right:60%:wrap'
  --header 'ğŸ“ æ–‡ä»¶ | Tab:ç§»åŠ¨ | Ctrl-J/K:å¤šé€‰ | Ctrl-/:é¢„è§ˆ'
"

# [Alt-C] ç›®å½•è·³è½¬
# ç›®å½•é€šå¸¸å•é€‰ï¼Œä½†é”®ä½ä¿æŒä¸€è‡´
export FZF_ALT_C_OPTS="
  --preview '$_FZF_PREVIEW_SCRIPT {}'
  --preview-window 'right:60%:wrap'
  --header 'ğŸ“‚ ç›®å½• | Tab:ç§»åŠ¨ | Enter:è¿›å…¥ | Ctrl-/:é¢„è§ˆ'
"

# [Ctrl-R] å†å²å‘½ä»¤
export FZF_CTRL_R_OPTS="
  --preview 'echo {}'
  --preview-window 'down:3:wrap:hidden'
  --bind 'ctrl-/:toggle-preview'
  --bind 'ctrl-y:execute-silent(echo -n {2..} | (pbcopy || xclip -selection clipboard))+abort'
  --header 'clock å†å² | Tab:ç§»åŠ¨ | Ctrl-Y:å¤åˆ¶ | Ctrl-R:æ’åº'
"
